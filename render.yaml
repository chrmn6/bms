services:
  - type: web
    name: bms
    env: php
    plan: free
    buildCommand: "composer install --optimize-autoloader --no-dev && php artisan config:cache && php artisan route:cache && php artisan view:cache"
    startCommand: "php artisan serve --host 0.0.0.0 --port 10000"
    envVars:
      - key: APP_ENV
        value: production
      - key: APP_DEBUG
        value: false

    staticPublishPath: public

    # Nginx config overrides
    nginx:
      extraConfig: |
        # -------------------------------
        # Caching for static assets
        # -------------------------------
        location ~* \.(png|jpg|jpeg|gif|svg|webp|woff2|woff|css|js)$ {
          expires 1y;
          add_header Cache-Control "public, max-age=31536000, immutable";
          try_files $uri $uri/ =404;
        }

        # Laravel front controller
        location / {
          try_files $uri $uri/ /index.php?$query_string;
        }
